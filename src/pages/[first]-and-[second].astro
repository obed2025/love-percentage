---
import Layout from '../layouts/Layout.astro';
import calculateLovePercentage from '../lib/percentage';
import Results from '../components/Results/index.svelte';
import { replaceUnderscores } from '../lib/utils';
import { actions } from 'astro:actions';

export const prerender = false;
let { first = '', second = '' } = Astro.params;
first = replaceUnderscores(first);
second = replaceUnderscores(second);

const names = `${first} & ${second}`;
const steps = calculateLovePercentage(first, second);
const percentage = steps.at(-1) ?? 0;

const title = `${first} Loves ${second} ${percentage}%`;
const desc = `${first} and ${second} have a love percentage of ${percentage}%.`;
const { data } = await Astro.callAction(actions.OGImageURL, {
  names,
  percentage,
});
---

<Layout {title} {desc} image={data}>
  <Results {first} {second} origin={Astro.url.origin} client:load />
</Layout>
